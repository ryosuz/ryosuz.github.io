---
import { skillCategories, otherTechnologies } from "@/data/skills";
import SectionHeader from "../SectionHeader.astro";
---

<section id="skills" class="py-24 scroll-mt-24 md:scroll-mt-15">
  <div class="max-w-5xl mx-auto px-6">
    <SectionHeader title="Skills" />

    <!-- メインスキルカテゴリ -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20">
      {
        skillCategories.map((category, catIndex) => (
          <div
            class="group p-6 rounded-2xl bg-white/40 backdrop-blur-sm border border-ink/5 shadow-sm hover:shadow-md hover:border-ink/10 transition-all duration-300 slide-up"
            style={`--delay: ${catIndex * 0.1}s`}
          >
            <h3 class="text-sm font-bold text-ink/40 uppercase tracking-wider mb-6 pb-2 border-b border-ink/5 group-hover:text-ink/60 transition-colors">
              {category.title}
            </h3>
            <ul class="space-y-6">
              {category.skills.map((skill) => (
                <li class="group/skill">
                  <div class="mb-2 flex justify-between items-end">
                    <div class="flex items-baseline justify-between gap-2 w-full">
                      <span class="text-ink font-medium group-hover/skill:text-ink-light transition-colors">
                        {skill.name}
                      </span>
                      <span class="text-xs text-ink/40 font-mono">
                        {skill.level === 5 && <span class="text-yellow-500 mr-0.5">★</span>}
                        Lv.{skill.level}
                      </span>
                    </div>
                  </div>
                  <div class="grid grid-cols-5 gap-1.5" data-skill-level={skill.level}>
                    {[1, 2, 3, 4, 5].map((level) => (
                      <div
                        class="h-1.5 rounded-full bg-ink/10 overflow-hidden"
                      >
                        <div
                          class="h-full bg-ink/60 w-0 transition-all duration-500 ease-out"
                          data-level-dot={level}
                        />
                      </div>
                    ))}
                  </div>
                </li>
              ))}
            </ul>
          </div>
        ))
      }
    </div>

    <!-- その他の技術 -->
    <div class="slide-up" style="--delay: 0.4s">
      <h3 class="text-sm font-bold text-ink/40 uppercase tracking-wider mb-6">
        Other Technologies
      </h3>
      <div class="flex flex-wrap gap-3">
        {
          otherTechnologies.map((tech, index) => (
            <span
              class="px-4 py-2 bg-white/40 backdrop-blur-sm border border-ink/5 rounded-lg text-sm text-ink-light hover:text-ink hover:border-ink/20 hover:shadow-sm hover:-translate-y-0.5 transition-all duration-300 cursor-default"
              style={`transition-delay: ${index * 0.05}s`}
            >
              {tech}
            </span>
          ))
        }
      </div>
    </div>
  </div>
</section>

<style>
  .slide-up {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    transition-delay: var(--delay, 0s);
  }

  .slide-up.visible {
    opacity: 1;
    transform: translateY(0);
  }

  /* ドットのアニメーション用クラス */
  .fill-dot {
    width: 100% !important;
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');

          // カードが表示されたら内部のスキルレベルもアニメーション開始
          const skillLevels = entry.target.querySelectorAll('[data-skill-level]');
          skillLevels.forEach((container) => {
            const level = parseInt(container.getAttribute('data-skill-level') || '0');
            const dots = container.querySelectorAll('[data-level-dot]');

            dots.forEach((dot, index) => {
              if (index < level) {
                // 順番に塗りつぶしていく
                setTimeout(() => {
                  dot.classList.add('fill-dot');
                }, 300 + (index * 100));
              }
            });
          });
        }
      });
    },
    { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
  );

  document.querySelectorAll('.slide-up').forEach((el) => {
    observer.observe(el);
  });
</script>
